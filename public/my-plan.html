<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Plan - MathsMayhem</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
        }
        
        .plan-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }
        
        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 0 3px 15px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .back-btn {
            display: inline-block;
            background: rgba(255,255,255,0.9);
            color: #667eea;
            padding: 12px 25px;
            border-radius: 20px;
            text-decoration: none;
            font-weight: bold;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .back-btn:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        
        .plan-status-card {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .plan-status-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #4caf50, #45a049);
        }
        
        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .plan-name {
            font-size: 1.8rem;
            font-weight: bold;
            color: #333;
            display: flex;
            align-items: center;
        }
        
        .plan-name i {
            margin-right: 15px;
            color: #4caf50;
        }
        
        .plan-badge {
            background: linear-gradient(90deg, #4caf50, #45a049);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        
        .plan-badge i {
            margin-right: 8px;
        }
        
        .billing-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .billing-item {
            background: #f8fafc;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        
        .billing-number {
            font-size: 1.8rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .billing-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        .renewal-info {
            background: #e8f5e8;
            border-radius: 15px;
            padding: 20px;
            border-left: 4px solid #4caf50;
        }
        
        .renewal-title {
            font-weight: bold;
            color: #2e7d2e;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .renewal-title i {
            margin-right: 10px;
        }
        
        .usage-analytics {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .usage-chart {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .chart-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }
        
        .chart-title i {
            margin-right: 10px;
            color: #667eea;
        }
        
        .usage-stats {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }
        
        .stat-item:last-child {
            border-bottom: none;
        }
        
        .stat-label {
            color: #666;
            font-weight: 500;
        }
        
        .stat-value {
            font-weight: bold;
            color: #333;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .feature-card {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }
        
        .feature-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .feature-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            margin-right: 15px;
        }
        
        .feature-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #333;
        }
        
        .feature-description {
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        
        .feature-status {
            font-weight: bold;
            color: #4caf50;
            display: flex;
            align-items: center;
        }
        
        .feature-status i {
            margin-right: 8px;
        }
        
        .billing-history {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            transition: all 0.3s ease;
        }
        
        .history-item:hover {
            background: #f8fafc;
            border-radius: 10px;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .history-date {
            font-weight: bold;
            color: #333;
        }
        
        .history-description {
            color: #666;
            flex: 1;
            margin: 0 20px;
        }
        
        .history-amount {
            font-weight: bold;
            color: #4caf50;
        }
        
        .download-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        .manage-section {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
        }
        
        .action-btn i {
            margin-right: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(90deg, #764ba2, #667eea);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #f8fafc;
            color: #667eea;
            border: 2px solid #667eea;
        }
        
        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }
        
        .btn-danger {
            background: #fee;
            color: #f44336;
            border: 2px solid #f44336;
        }
        
        .btn-danger:hover {
            background: #f44336;
            color: white;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .usage-analytics {
                grid-template-columns: 1fr;
            }
            
            .billing-summary {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="plan-container">
        <a href="index.html" class="back-btn"><i class="fas fa-arrow-left"></i> Back to Dashboard</a>
        
        <div class="header">
            <h1>📋 My Subscription Plan</h1>
            <p>Manage your subscription, view usage, and track your math learning journey</p>
        </div>
        
        <!-- Current Plan Status -->
        <div class="plan-status-card">
            <div class="status-header">
                <div class="plan-name">
                    <i class="fas fa-star"></i>
                    <span id="currentPlanName">Premium Math Champion</span>
                </div>
                <div class="plan-badge">
                    <i class="fas fa-check-circle"></i>
                    Active
                </div>
            </div>
            
            <div class="billing-summary">
                <div class="billing-item">
                    <div class="billing-number" id="monthlyPrice">£1.50</div>
                    <div class="billing-label">Monthly Price</div>
                </div>
                <div class="billing-item">
                    <div class="billing-number" id="nextBilling">Dec 15, 2024</div>
                    <div class="billing-label">Next Billing</div>
                </div>
                <div class="billing-item">
                    <div class="billing-number" id="totalSaved">£47.50</div>
                    <div class="billing-label">Total Saved</div>
                </div>
                <div class="billing-item">
                    <div class="billing-number" id="memberSince">Jan 2024</div>
                    <div class="billing-label">Member Since</div>
                </div>
            </div>
            
            <div class="renewal-info">
                <div class="renewal-title">
                    <i class="fas fa-sync"></i>
                    Auto-Renewal Information
                </div>
                <div style="color: #2e7d2e;">
                    Your subscription will automatically renew on <strong>December 15, 2024</strong> for £1.50. 
                    You can cancel anytime before then to avoid charges.
                </div>
            </div>
        </div>
        
        <!-- Usage Analytics -->
        <div class="usage-analytics">
            <div class="usage-chart">
                <div class="chart-title">
                    <i class="fas fa-chart-line"></i>
                    Monthly Usage Trends
                </div>
                <canvas id="usageChart" height="100"></canvas>
            </div>
            
            <div class="usage-stats">
                <div class="chart-title">
                    <i class="fas fa-info-circle"></i>
                    This Month's Stats
                </div>
                <div class="stat-item">
                    <div class="stat-label">Quizzes Taken</div>
                    <div class="stat-value">147</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Study Hours</div>
                    <div class="stat-value">23.5h</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Problems Solved</div>
                    <div class="stat-value">892</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Average Score</div>
                    <div class="stat-value">89.3%</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Achievements Earned</div>
                    <div class="stat-value">12</div>
                </div>
            </div>
        </div>
        
        <!-- Premium Features -->
        <div style="margin-bottom: 30px;">
            <h2 style="color: white; text-align: center; margin-bottom: 25px; font-size: 2rem;">
                🌟 Your Premium Features
            </h2>
            
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-header">
                        <div class="feature-icon" style="background: linear-gradient(45deg, #4CAF50, #45a049);">
                            <i class="fas fa-infinity"></i>
                        </div>
                        <div class="feature-title">Unlimited Quizzes</div>
                    </div>
                    <div class="feature-description">
                        Take as many quizzes as you want across all topics and difficulty levels. No daily limits or waiting periods.
                    </div>
                    <div class="feature-status">
                        <i class="fas fa-check"></i>
                        Active - 147 quizzes this month
                    </div>
                </div>
                
                <div class="feature-card">
                    <div class="feature-header">
                        <div class="feature-icon" style="background: linear-gradient(45deg, #2196F3, #1976D2);">
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <div class="feature-title">Advanced Analytics</div>
                    </div>
                    <div class="feature-description">
                        Detailed performance tracking with insights, trends, and personalized recommendations for improvement.
                    </div>
                    <div class="feature-status">
                        <i class="fas fa-check"></i>
                        Tracking 12 metrics
                    </div>
                </div>
                
                <div class="feature-card">
                    <div class="feature-header">
                        <div class="feature-icon" style="background: linear-gradient(45deg, #9C27B0, #7B1FA2);">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="feature-title">AI Homework Helper</div>
                    </div>
                    <div class="feature-description">
                        Get step-by-step solutions and explanations for any math problem with our AI-powered homework assistant.
                    </div>
                    <div class="feature-status">
                        <i class="fas fa-check"></i>
                        47 problems solved
                    </div>
                </div>
                
                <div class="feature-card">
                    <div class="feature-header">
                        <div class="feature-icon" style="background: linear-gradient(45deg, #FF9800, #F57C00);">
                            <i class="fas fa-trophy"></i>
                        </div>
                        <div class="feature-title">Competition Prep</div>
                    </div>
                    <div class="feature-description">
                        Specialized training for AMC, MATHCOUNTS, and other math competitions with real exam simulations.
                    </div>
                    <div class="feature-status">
                        <i class="fas fa-check"></i>
                        AMC 8 prep active
                    </div>
                </div>
                
                <div class="feature-card">
                    <div class="feature-header">
                        <div class="feature-icon" style="background: linear-gradient(45deg, #FF5722, #D84315);">
                            <i class="fas fa-ban"></i>
                        </div>
                        <div class="feature-title">Ad-Free Experience</div>
                    </div>
                    <div class="feature-description">
                        Enjoy uninterrupted learning with no advertisements or distractions throughout your study sessions.
                    </div>
                    <div class="feature-status">
                        <i class="fas fa-check"></i>
                        Zero ads shown
                    </div>
                </div>
                
                <div class="feature-card">
                    <div class="feature-header">
                        <div class="feature-icon" style="background: linear-gradient(45deg, #795548, #5D4037);">
                            <i class="fas fa-headset"></i>
                        </div>
                        <div class="feature-title">Priority Support</div>
                    </div>
                    <div class="feature-description">
                        Get faster help from our support team with priority ticket handling and direct access to experts.
                    </div>
                    <div class="feature-status">
                        <i class="fas fa-check"></i>
                        <24h response time
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Billing History -->
        <div class="billing-history">
            <div class="chart-title">
                <i class="fas fa-receipt"></i>
                Billing History
            </div>
            
            <div class="history-item">
                <div class="history-date">Nov 15, 2024</div>
                <div class="history-description">Premium Math Champion - Monthly</div>
                <div class="history-amount">£1.50</div>
                <button class="download-btn"><i class="fas fa-download"></i> Receipt</button>
            </div>
            
            <div class="history-item">
                <div class="history-date">Oct 15, 2024</div>
                <div class="history-description">Premium Math Champion - Monthly</div>
                <div class="history-amount">£1.50</div>
                <button class="download-btn"><i class="fas fa-download"></i> Receipt</button>
            </div>
            
            <div class="history-item">
                <div class="history-date">Sep 15, 2024</div>
                <div class="history-description">Premium Math Champion - Monthly</div>
                <div class="history-amount">£1.50</div>
                <button class="download-btn"><i class="fas fa-download"></i> Receipt</button>
            </div>
            
            <div class="history-item">
                <div class="history-date">Aug 15, 2024</div>
                <div class="history-description">Premium Math Champion - Monthly</div>
                <div class="history-amount">£1.50</div>
                <button class="download-btn"><i class="fas fa-download"></i> Receipt</button>
            </div>
            
            <div class="history-item">
                <div class="history-date">Jan 15, 2024</div>
                <div class="history-description">7-Day Free Trial Started</div>
                <div class="history-amount">£0.00</div>
                <button class="download-btn"><i class="fas fa-download"></i> Receipt</button>
            </div>
        </div>
        
        <!-- Manage Subscription -->
        <div class="manage-section">
            <div class="chart-title">
                <i class="fas fa-cog"></i>
                Manage Subscription
            </div>
            
            <div class="action-buttons">
                <button class="action-btn btn-primary" onclick="upgradeSubscription()">
                    <i class="fas fa-arrow-up"></i>
                    Upgrade Plan
                </button>
                
                <button class="action-btn btn-secondary" onclick="updatePaymentMethod()">
                    <i class="fas fa-credit-card"></i>
                    Update Payment
                </button>
                
                <button class="action-btn btn-secondary" onclick="changeBillingCycle()">
                    <i class="fas fa-calendar"></i>
                    Change Billing Cycle
                </button>
                
                <button class="action-btn btn-secondary" onclick="downloadData()">
                    <i class="fas fa-download"></i>
                    Download My Data
                </button>
                
                <button class="action-btn btn-danger" onclick="cancelSubscription()">
                    <i class="fas fa-times"></i>
                    Cancel Subscription
                </button>
            </div>
        </div>
    </div>
    
    <script src="data-migration.js"></script>
    <script src="user-manager.js"></script>
    <script>
        // Initialize usage chart
        function initUsageChart() {
            const ctx = document.getElementById('usageChart').getContext('2d');
            
            const data = {
                labels: ['Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                datasets: [{
                    label: 'Quizzes Taken',
                    data: [89, 124, 156, 147, 168],
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    tension: 0.4,
                    fill: true
                }, {
                    label: 'Study Hours',
                    data: [18, 22, 28, 23.5, 31],
                    borderColor: '#4caf50',
                    backgroundColor: 'rgba(76, 175, 80, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            };
            
            new Chart(ctx, {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Subscription management functions
        function upgradeSubscription() {
            const currentPlan = localStorage.getItem('subscriptionPlan') || 'premium';
            let upgradeOptions = '';
            
            switch(currentPlan) {
                case 'premium':
                    upgradeOptions = '• Family Pack (£3.50/month) - Up to 6 accounts\n• Pro Tutor (£5.99/month) - AI tutoring\n• Math Genius (£9.99/month) - All features';
                    break;
                case 'family':
                    upgradeOptions = '• Pro Tutor (£5.99/month) - AI tutoring\n• Math Genius (£9.99/month) - All features';
                    break;
                case 'tutor':
                    upgradeOptions = '• Math Genius (£9.99/month) - All features + Competition prep';
                    break;
                default:
                    upgradeOptions = '• Premium (£1.50/month) - Unlimited quizzes\n• Family Pack (£3.50/month) - Up to 6 accounts';
            }
            
            if (currentPlan === 'genius') {
                alert('🎉 You already have our highest plan!\n\nYou\'re getting all premium features including:\n• Unlimited everything\n• AI tutoring\n• Competition prep\n• University content\n• Research projects');
            } else {
                if (confirm(`🚀 Upgrade Your Plan\n\nAvailable upgrades:\n${upgradeOptions}\n\nWould you like to see upgrade options?`)) {
                    window.location.href = 'subscription.html';
                }
            }
        }
        
        function updatePaymentMethod() {
            alert('💳 Update Payment Method\n\nThis would redirect to a secure payment portal to:\n• Add new payment methods\n• Update billing address\n• Change default payment method\n• View saved cards');
        }
        
        function changeBillingCycle() {
            const options = ['Monthly (current)', 'Annual (save 20%)', 'Quarterly (save 10%)'];
            const choice = confirm('📅 Change Billing Cycle\n\nOptions:\n• Monthly: £1.50/month\n• Annual: £14.40/year (save £3.60)\n• Quarterly: £4.05/quarter (save 10%)\n\nSwitch to annual billing?');
            
            if (choice) {
                alert('✅ Billing cycle updated!\n\nYou\'ll be switched to annual billing on your next renewal date. You\'ll save £3.60 per year!');
            }
        }
        
        function downloadData() {
            alert('📊 Download Your Data\n\nThis will generate a comprehensive report including:\n• All quiz results and scores\n• Study time and progress\n• Achievement history\n• Billing and payment history\n\nReport will be emailed to you within 24 hours.');
        }
        
        function cancelSubscription() {
            const reasons = [
                'Too expensive',
                'Not using enough',
                'Found alternative',
                'Technical issues',
                'Content not suitable',
                'Other'
            ];
            
            if (confirm('😢 Cancel Subscription?\n\nBefore you go:\n• Your plan remains active until Dec 15\n• You\'ll lose access to premium features\n• All progress will be saved\n• You can resubscribe anytime\n\nAre you sure you want to cancel?')) {
                const feedback = prompt('We\'d love to improve! What\'s the main reason for canceling?\n\n1. Too expensive\n2. Not using enough\n3. Found alternative\n4. Technical issues\n5. Content not suitable\n6. Other\n\nEnter number (1-6):');
                
                alert('💔 Subscription Canceled\n\nWe\'re sorry to see you go!\n\n• Your plan remains active until Dec 15, 2024\n• You can reactivate anytime before then\n• All your progress and data is saved\n• We\'ve sent a confirmation email\n\nThanks for being part of MathsMayhem!');
                
                // Update UI to show canceled status
                document.querySelector('.plan-badge').innerHTML = '<i class="fas fa-exclamation-triangle"></i> Canceling';
                document.querySelector('.plan-badge').style.background = 'linear-gradient(90deg, #ff9800, #f57c00)';
            }
        }
        
        // Real-time updates
        function updateRealTimeStats() {
            const stats = ['147', '23.5h', '892', '89.3%', '12'];
            const statElements = document.querySelectorAll('.stat-value');
            
            statElements.forEach((element, index) => {
                if (Math.random() < 0.1) { // 10% chance of update
                    element.style.animation = 'pulse 0.5s';
                    setTimeout(() => {
                        element.style.animation = '';
                    }, 500);
                }
            });
        }
        
        // Add pulse animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.05); }
                100% { transform: scale(1); }
            }
        `;
        document.head.appendChild(style);
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Load user's subscription plan
            const subscriptionPlan = localStorage.getItem('subscriptionPlan') || 'premium';
            const planNames = {
                free: 'Free Explorer',
                premium: 'Premium Math Champion',
                family: 'Family Pack',
                school: 'Schools & Education',
                tutor: 'Pro Tutor',
                genius: 'Math Genius'
            };
            
            const planPrices = {
                free: '£0.00',
                premium: '£1.50',
                family: '£3.50',
                school: '£12.50',
                tutor: '£5.99',
                genius: '£9.99'
            };
            
            // Update plan display
            document.getElementById('currentPlanName').textContent = planNames[subscriptionPlan];
            document.getElementById('monthlyPrice').textContent = planPrices[subscriptionPlan];
            
            // Initialize chart
            initUsageChart();
            
            // Start real-time updates
            setInterval(updateRealTimeStats, 7000);
        });
    </script>
</body>
</html>
